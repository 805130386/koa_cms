<!DOCTYPE html>
<html lang="en">
{{include 'admin/public/head.html'}}

<body>
	{{include 'admin/public/nav_top.html'}}


	<div class="main-container" id="main-container">
		<script type="text/javascript">
			try {
				ace.settings.check('main-container', 'fixed')
			} catch (e) {}
		</script>

		<div class="main-container-inner">
			<a class="menu-toggler" id="menu-toggler" href="#">
				<span class="menu-text"></span>
			</a>

			<div class="sidebar" id="sidebar">
				<script type="text/javascript">
					try {
						ace.settings.check('sidebar', 'fixed')
					} catch (e) {}
				</script>

				<div class="sidebar-shortcuts" id="sidebar-shortcuts">
					<div class="sidebar-shortcuts-large" id="sidebar-shortcuts-large">
						<button class="btn btn-success">
							<i class="icon-signal"></i>
						</button>

						<button class="btn btn-info">
							<i class="icon-pencil"></i>
						</button>

						<button class="btn btn-warning">
							<i class="icon-group"></i>
						</button>

						<button class="btn btn-danger">
							<i class="icon-cogs"></i>
						</button>
					</div>

					<div class="sidebar-shortcuts-mini" id="sidebar-shortcuts-mini">
						<span class="btn btn-success"></span>

						<span class="btn btn-info"></span>

						<span class="btn btn-warning"></span>

						<span class="btn btn-danger"></span>
					</div>
				</div>
				<!-- #sidebar-shortcuts -->
				{{include 'admin/public/nav_left.html'}}
				<!-- /.nav-list -->

				<div class="sidebar-collapse" id="sidebar-collapse">
					<i class="icon-double-angle-left" data-icon1="icon-double-angle-left"
						data-icon2="icon-double-angle-right"></i>
				</div>

				<script type="text/javascript">
					try {
						ace.settings.check('sidebar', 'collapsed')
					} catch (e) {}
				</script>
			</div>

			<div class="main-content">
				<div class="breadcrumbs" id="breadcrumbs">
					<script type="text/javascript">
						try {
							ace.settings.check('breadcrumbs', 'fixed')
						} catch (e) {}
					</script>

					<ul class="breadcrumb">
						<li>
							<i class="icon-home home-icon"></i>
							<a href="#">首页</a>
						</li>
						<li class="active">控制台</li>
					</ul><!-- .breadcrumb -->

					<div class="nav-search" id="nav-search">
						<form class="form-search">
							<span class="input-icon">
								<input type="text" placeholder="Search ..." class="nav-search-input"
									id="nav-search-input" autocomplete="off" />
								<i class="icon-search nav-search-icon"></i>
							</span>
						</form>
					</div><!-- #nav-search -->
				</div>

				<div class="page-content">

					<div class="page-header">
						<h1>
							用户管理列表
						</h1>
					</div><!-- /.page-header -->



					<!--表格-->

					<div class="table-responsive">
						<table id="sample-table-1" class="table table-striped table-bordered table-hover center">
							<thead>
								<tr>

									<th class="center">用户名</th>

									<th class="center">
										<i class="icon-time bigger-110 hidden-480"></i>
										最后登录时间
									</th>
									<th class="center">状态</th>

									<th width="80px;" class="center">操作</th>
								</tr>
							</thead>

							<tbody>
								{{each list}}
								<tr>
									<td>
										{{$value.username}}
									</td>
									<td>
										{{$value.lastTime}}
									</td>

									<td class="hidden-480">
										{{if $value.status=="1"}}
										<button class="btn btn-xs btn-success">

											<i class="icon-ok" onclick="toggleUserStatus(this,{{$value}})"
												style="display: block;width: 100%;height: 100%;"></i>
										</button>
										{{else}}
										<button class="btn btn-xs btn-success">
											<i class="icon-remove" onclick="toggleUserStatus(this,{{$value}})"
												style="display: block;width: 100%;height: 100%;"></i>
										</button>
										{{/if}}
									</td>

									<td>
										<div class="visible-md visible-lg hidden-sm hidden-xs btn-group center"
											style="width: 120px;">


											<a href="{{__HOST__}}/admin/user/edit?id={{@$value._id}}">
												<button class="btn btn-xs btn-info">
													<i class="icon-edit"></i>
												</button>
											</a>
											&nbsp;
											<a href="{{__HOST__}}/admin/user/delete?id={{@$value._id}}" id="deleteUser">
												<button class="btn btn-xs btn-danger">
													<i class="icon-trash"></i>
												</button>
											</a>
										</div>

									</td>
								</tr>
								{{/each}}
							</tbody>
						</table>
						<div id="page" class="pagination">

						</div>
					</div>

				</div>
			</div><!-- /.main-content -->

		</div><!-- /.main-container-inner -->

		<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
			<i class="icon-double-angle-up icon-only bigger-110"></i>
		</a>
	</div><!-- /.main-container -->

	{{include 'admin/public/footer.html'}}
	<script>
		//user分页		
		$.get('/admin/user/count', (totalCounts) => {
			$('#page').jqPaginator({
				totalCounts,
				pageSize: 5,
				currentPage: {{current}},
				visiblePages: 10,
				onPageChange: function (num, type) {
					if (type === 'change') {
						location.href = '{{__HOST__}}/admin/user/list?current=' + num
					}
				}
			});
		})
		//删除用户
		$('#deleteUser').click(function () {
			if (confirm('确定要删除该用户吗？')) {
				return true
			} else {
				return false

			}
		})
		//切换用户状态
		function toggleUserStatus(event, data) {
			//根据样式名称设置状态值
			if (event.className === 'icon-ok') {
				data.status = '1'
			} else {
				data.status = '0'
			}
			$.get('{{__HOST__}}/admin/user/changeUserState', data, function (res) {
				//如果修改状态成功
				if (res.message) {
					if (event.className === 'icon-ok') {
						event.className = 'icon-remove'
					} else {
						event.className = 'icon-ok'
					}
				}
			})
		}
	</script>
</body>

</html>